(this.webpackJsonpcmv=this.webpackJsonpcmv||[]).push([[0],{46:function(e,t,a){},49:function(e,t,a){},62:function(e,t,a){},63:function(e,t,a){},7:function(e){e.exports=JSON.parse('{"title":"Compartment Model Visualizer","writeModelTitle":"Write a Model","howToWriteModelTitle":"How to Write a Model","loadModelTitle":"Or Load a Model","modelTextAreaPlaceholder":"Write DSL Here","loadModelButton":"Load Model into Simulator","reloadModelButton":"Reload Model and Reset Simulator","saveModelButton":"Save Model","solverTitle":"Solver","setStepSizeButton":"Set Step Size","timeControlTitle":"Time Control","simulateForButton":"SimulateFor","models":[{"name":"Custom","value":""},{"name":"SIR","value":"(param alpha 0.75)\\n(param beta 0.1)\\n(param N 10000)\\n\\n(comp S 9999 {-alpha*S*I/N})\\n(comp I 1 {alpha*S*I/N - beta*I})\\n(comp R 0 {beta*I})"}]}')},76:function(e,t,a){},77:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),s=a(29),i=a.n(s),o=(a(46),a(3)),c=a(4),l=a(5),u=a(6),h=function(){function e(t,a,n){Object(o.a)(this,e),this.stepSize=void 0,this.timeStep=void 0,this.model=void 0,this.stepSize=t,this.timeStep=a,this.model=n}return Object(c.a)(e,[{key:"evaluateExpression",value:function(e,t){return e.evaluate(Object.fromEntries(t))}},{key:"generateVariables",value:function(){var e=new Map;return this.model.compartments.forEach((function(t){return e.set(t.name,t.value[t.value.length-1])})),e}}]),e}(),p=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"execute",value:function(){var e=this,t=this.generateVariables(),a=new Map;return this.model.compartments.forEach((function(n){var r=e.evaluateExpression(n.ODE,t)*e.stepSize;a.set(n.name,n.value[n.value.length-1]+r)})),this.timeStep=this.timeStep+this.stepSize,{result:a,timeStep:this.timeStep}}}]),a}(h),m=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"execute",value:function(){var e=this,t=this.generateVariables(),a=new Map,n=new Map(t);return this.model.compartments.forEach((function(a){var r=e.evaluateExpression(a.ODE,t)*(e.stepSize/2);n.set(a.name,a.value[a.value.length-1]+r)})),this.model.compartments.forEach((function(t){var r=e.evaluateExpression(t.ODE,n)*e.stepSize;a.set(t.name,t.value[t.value.length-1]+r)})),this.timeStep=this.timeStep+this.stepSize,{result:a,timeStep:this.timeStep}}}]),a}(h),d=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"calculateStep",value:function(e,t){var a=this,n=new Map,r=new Map(e),s=new Map;return this.model.compartments.forEach((function(n){var i=a.evaluateExpression(n.ODE,e)*t;r.set(n.name,e.get(n.name)+i/2),s.set(n.name,[i])})),this.model.compartments.forEach((function(n){var i=a.evaluateExpression(n.ODE,r)*t;r.set(n.name,e.get(n.name)+i/2),s.get(n.name).push(i)})),this.model.compartments.forEach((function(n){var i=a.evaluateExpression(n.ODE,r)*t;r.set(n.name,e.get(n.name)+i),s.get(n.name).push(i)})),this.model.compartments.forEach((function(e){var n=a.evaluateExpression(e.ODE,r)*t;s.get(e.name).push(n)})),this.model.compartments.forEach((function(t){n.set(t.name,e.get(t.name)+1/6*s.get(t.name)[0]+2/6*s.get(t.name)[1]+2/6*s.get(t.name)[2]+1/6*s.get(t.name)[3])})),n}}]),a}(h),v=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(c.a)(a,[{key:"execute",value:function(){var e=this.generateVariables();return this.timeStep=this.timeStep+this.stepSize,{result:this.calculateStep(e,this.stepSize),timeStep:this.timeStep}}}]),a}(d),S=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e,n,r){var s;return Object(o.a)(this,a),(s=t.call(this,e,n,r)).error=void 0,s.error=0,s}return Object(c.a)(a,[{key:"execute",value:function(){var e=[],t=.01,a=this.generateVariables();do{this.error<.0025?this.stepSize=2*this.stepSize:this.error>t&&(this.stepSize=this.stepSize/2);var n=this.calculateStep(a,this.stepSize),r=this.calculateStep(this.calculateStep(a,this.stepSize/2),this.stepSize/2);Array.from(n.values()).forEach((function(t,a){e.push(Math.abs(Array.from(r.values())[a]-t))})),this.error=e.reduce((function(e,t){return e+t}),0)/e.length}while(this.error>t);return this.timeStep=this.timeStep+this.stepSize,{result:r,timeStep:this.timeStep}}}]),a}(d),f=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e,n,r,s){var i;return Object(o.a)(this,a),(i=t.call(this,e,n,r)).error=void 0,i.depth=void 0,i.error=0,i.depth=s,i}return Object(c.a)(a,[{key:"execute",value:function(){var e=this,t=this.generateVariables(),a=.001,n=[];do{this.error<5e-4?this.depth>2?this.depth=this.depth-1:(this.stepSize=2*this.stepSize,this.depth=this.depth+1):this.error>a&&(this.depth<8?this.depth=this.depth+1:(this.stepSize=this.stepSize/2,this.depth=this.depth-1));for(var r=[],s=function(a){n[a]=[];for(var s=function(s){0===s?n[a][s]=e.modifiedMidpointMethod(t,2*(a+1)):(o=new Map,e.model.compartments.forEach((function(t){var i=n[a][s-1].get(t.name)+(n[a][s-1].get(t.name)-n[a-1][s-1].get(t.name))/(Math.pow(a/(a-1),2*s)-1);o.set(t.name,i),s===a&&a===e.depth-1&&r.push(Math.abs((n[a][s-1].get(t.name)-n[a-1][s-1].get(t.name))/(Math.pow(a/(a-1),2*s)-1)))})),n[a][s]=o)},i=0;i<=a;i++)s(i)},i=0;i<this.depth;i++){var o;s(i)}this.error=r.reduce((function(e,t){return e+t}),0)/r.length}while(this.error>a);return this.timeStep=this.timeStep+this.stepSize,{result:n[n.length-1][n[n.length-1].length-1],timeStep:this.timeStep}}},{key:"modifiedMidpointMethod",value:function(e,t){var a=this,n=this.stepSize/t,r=new Map(e),s=new Map,i=new Map;this.model.compartments.forEach((function(e){var t=a.evaluateExpression(e.ODE,r),i=e.value[e.value.length-1]+n*t;r.set(e.name,i),s.set(e.name,[e.value[e.value.length-1],i])}));for(var o=function(e){a.model.compartments.forEach((function(t){var i=a.evaluateExpression(t.ODE,r),o=s.get(t.name)[e-1]+2*n*i;r.set(t.name,o),s.get(t.name).push(o)}))},c=1;c<t;c++)o(c);return this.model.compartments.forEach((function(e){var o=a.evaluateExpression(e.ODE,r),c=.5*(s.get(e.name)[t]+s.get(e.name)[t-1]+n*o);i.set(e.name,c)})),i}}]),a}(h),j=a(32),b=(a(49),function(){function e(){Object(o.a)(this,e)}return Object(c.a)(e,null,[{key:"exportToCsv",value:function(e,t){var a=t.map((function(e){return e.join(",")})).join("\n"),n=new Blob([a],{type:"text/csv;charset=utf-8;"});if(navigator.msSaveBlob)navigator.msSaveBlob(n,e);else{var r=document.createElement("a");if(void 0!==r.download){var s=URL.createObjectURL(n);r.setAttribute("href",s),r.setAttribute("download",e),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}}}}]),e}()),O=a(2),g=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(o.a)(this,a),(n=t.call(this,e)).onClickGetData=function(){b.exportToCsv("data.csv",n.state.data)};var r=n.generateData();return n.state={data:r},n}return Object(c.a)(a,[{key:"generateData",value:function(){var e=this,t=["x"];this.props.model.compartments.forEach((function(e){return t.push(e.name)}));for(var a=[t],n=function(t){s=[e.props.timeSteps[t]],e.props.model.compartments.forEach((function(e){return s.push(e.value[t])})),a.push(s)},r=0;r<=this.props.currentTick;r++){var s;n(r)}return a}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return Object(O.jsxs)("div",{className:"chart",children:["Chart",Object(O.jsx)(j.a,{width:"600px",height:"400px",chartType:"LineChart",loader:Object(O.jsx)("div",{children:"Loading Chart"}),data:this.state.data,options:{hAxis:{title:"Time"},vAxis:{title:"Value"}},rootProps:{"data-testid":"2"}}),Object(O.jsx)("button",{onClick:this.onClickGetData,children:"Get Data"})]})}}]),a}(r.a.Component),x=a(39),M=(a(62),function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(o.a)(this,a);var r=(n=t.call(this,e)).generateInitialDataStructure();return n.state={data:r},n}return Object(c.a)(a,[{key:"generateInitialDataStructure",value:function(){var e=[];this.props.model.compartments.forEach((function(t){e.push({id:t.name,size:10})}));var t=[];return this.props.model.compartments.forEach((function(e){e.ODE.symbols().forEach((function(a){return t.push({source:e.name,target:a})}))})),{nodes:e,links:t}}},{key:"componentDidMount",value:function(){}},{key:"onClick",value:function(){}},{key:"render",value:function(){return Object(O.jsxs)("div",{className:"graph",children:["Graph",Object(O.jsx)(x.a,{graphData:this.state.data,nodeLabel:"id",nodeVal:function(e){return e.size},width:500,height:500})]})}}]),a}(r.a.Component)),E=(a(63),a(38)),k=a(7),z=a.t(k,2),y=a(75).Parser,C=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;Object(o.a)(this,a),(n=t.call(this,e)).onLoadModel=function(e){try{var t=n.state.parser.parse(n.state.value),a=new Map;t.parameters.forEach((function(e){return a.set(e.name,e.value)})),t.compartments.forEach((function(e){return e.ODE=y.parse(e.ODE).simplify(Object.fromEntries(a))})),n.props.setNewModel(t),n.setState({error:{hasError:!1,message:"",location:""}});var r=new Map;t.compartments.forEach((function(e){return r.set(e.name,e.value[0])})),t.compartments.forEach((function(e){try{e.ODE.evaluate(Object.fromEntries(r))}catch(t){n.setState({error:{hasError:!0,message:t.message,location:"ODE for "+e.name}}),console.log(t)}})),n.setState({loadedModel:!0})}catch(s){void 0!==s.location&&n.setState({error:{hasError:!0,message:s.message,location:"at line: "+s.location.start.line+" at column: "+s.location.start.column}}),console.log(s)}e.preventDefault()},n.handleSelectedModel=function(e){n.setState({selectedModel:e.target.value,value:k.models.concat(n.state.customModels)[e.target.value].value})},n.onSaveModel=function(){n.state.customModels.push({name:"Custom Model "+n.state.customModels.length,value:n.state.value}),localStorage.setItem("savedModels",JSON.stringify(n.state.customModels)),n.setState({selectedModel:n.state.customModels.length+1})};var r=localStorage.getItem("savedModels");return console.log(r),n.state={value:"",parser:Object(E.generate)('{{\nfunction makeFloat(o) {\n    return parseFloat(o.join(""), 10);\n}\n}}\n\nmodel = parameters:parameter* _ compartments:compartment+ {return {parameters, compartments};}\ncompartment = "(" _ "comp" _ name:ident _ value:value _ ODE:calc _ ")" _ {return {name, value:[value], ODE};}\nparameter = "(" _ "param" _ name:ident _ value:value _ ")" _ {return {name, value};}\nident = ident:[A-Za-z]+ {return ident.join("")}\nvalue = digits:[0-9.]+ {return makeFloat(digits);}\n_ "whitespace" = [ \\t\\n\\r]*\ncalc = "{" calc:[^}]* "}" {return calc.join("")}'),error:{hasError:!1,message:"",location:""},loadedModel:!1,selectedModel:0,customModels:r?JSON.parse(r):[]},n}return Object(c.a)(a,[{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"componentDidMount",value:function(){}},{key:"renderError",value:function(){if(this.state.error.hasError)return Object(O.jsxs)("div",{children:["Error: ",this.state.error.message," at ",this.state.error.location]})}},{key:"generateDropdownOptions",value:function(){var e=[];return k.models.concat(this.state.customModels).forEach((function(t,a){return e.push(Object(O.jsx)("option",{value:a,children:t.name},a))})),e}},{key:"render",value:function(){var e=this.renderError();return Object(O.jsxs)("div",{className:"parser",children:[k.writeModelTitle,": ",Object(O.jsx)("a",{href:"https://github.com/NeverfullD/cmv",children:k.howToWriteModelTitle}),Object(O.jsx)("br",{}),k.loadModelTitle,":"," ",Object(O.jsx)("select",{value:this.state.selectedModel,onChange:this.handleSelectedModel,children:this.generateDropdownOptions()}),Object(O.jsx)("br",{}),Object(O.jsx)("textarea",{className:"parserText",placeholder:k.modelTextAreaPlaceholder,value:this.state.value,onChange:this.handleChange.bind(this)}),Object(O.jsx)("br",{}),Object(O.jsx)("button",{onClick:this.onLoadModel,children:this.state.loadedModel?k.reloadModelButton:k.loadModelButton}),Object(O.jsx)("button",{onClick:this.onSaveModel,children:k.saveModelButton}),Object(O.jsx)("br",{}),e]})}}]),a}(r.a.Component),w=(a(76),function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).onSimulate1=function(){n.props.onSimulate(1)},n.onSimulate10=function(){n.props.onSimulate(10)},n.onSimulate100=function(){n.props.onSimulate(100)},n.onSimulate1000=function(){n.props.onSimulate(1e3)},n.onSimulate=function(){n.props.onSimulate(parseInt(n.state.steps))},n.onChangeStepSize=function(){n.props.changeStepSize(parseFloat(n.state.stepSize))},n.handleChangeSteps=function(e){n.setState({steps:e.target.value})},n.handleChangeStepSize=function(e){n.setState({stepSize:e.target.value})},n.handleSelectedSolver=function(e){n.props.changeSelectedSolver(e.target.value)},n.state={steps:"",stepSize:""},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return Object(O.jsxs)("div",{className:"settings",children:["Settings",Object(O.jsx)("br",{}),Object(O.jsx)("button",{onClick:this.onSimulate1,children:"Simulate 1"}),Object(O.jsx)("button",{onClick:this.onSimulate10,children:"Simulate 10"}),Object(O.jsx)("button",{onClick:this.onSimulate100,children:"Simulate 100"}),Object(O.jsx)("button",{onClick:this.onSimulate1000,children:"Simulate 1000"}),Object(O.jsx)("button",{onClick:this.onSimulate,children:"Simulate: "}),Object(O.jsx)("input",{type:"text",value:this.state.steps,onChange:this.handleChangeSteps}),Object(O.jsx)("br",{}),Object(O.jsxs)("button",{onClick:this.onChangeStepSize,children:["Change Step Size (currently: ",this.props.stepSize,"): "]}),Object(O.jsx)("input",{type:"text",value:this.state.stepSize,onChange:this.handleChangeStepSize}),Object(O.jsx)("br",{}),Object(O.jsx)("label",{children:"Choose a Solver:"}),Object(O.jsxs)("select",{value:this.props.selectedSolver,onChange:this.handleSelectedSolver,children:[Object(O.jsx)("option",{value:"euler",children:"Euler"}),Object(O.jsx)("option",{value:"rungeKutta2",children:"Runge-Kutta 2.Order"}),Object(O.jsx)("option",{value:"rungeKutta4",children:"Runge-Kutta 4.Order"}),Object(O.jsx)("option",{value:"rungeKutta4Automatic",children:"Runge-Kutta 4.Order Automatic"}),Object(O.jsx)("option",{value:"bulirschStoer",children:"Bulirsch-Stoer"})]})]})}}]),a}(r.a.Component)),D=function(e){Object(l.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).onClick=function(){console.log(z)},n.setModel=function(e){n.setState({model:e,currentTick:0,timeSteps:[0],solver:n.getSolver(n.state.selectedSolver,0,e)})},n.onSimulate=function(e){n.solveSteps(e)},n.changeStepSize=function(e){n.setState({stepSize:e})},n.changeSelectedSolver=function(e){n.setState({selectedSolver:e,solver:n.getSolver(e,n.state.timeSteps[n.state.timeSteps.length-1],n.state.model)})},n.state={model:{parameters:[],compartments:[]},currentTick:0,timeSteps:[],stepSize:.1,solver:new p(0,0,{parameters:[],compartments:[]}),selectedSolver:"euler"},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){}},{key:"getSolver",value:function(e,t,a){switch(e){case"euler":return new p(this.state.stepSize,t,a);case"rungeKutta2":return new m(this.state.stepSize,t,a);case"rungeKutta4":return new v(this.state.stepSize,t,a);case"rungeKutta4Automatic":return new S(this.state.stepSize,t,a);case"bulirschStoer":return new f(this.state.stepSize,t,a,4);default:return new p(this.state.stepSize,t,a)}}},{key:"applyResult",value:function(e){this.state.model.compartments.forEach((function(t){t.value.push(e.result.get(t.name))})),this.state.timeSteps.push(e.timeStep)}},{key:"solveSteps",value:function(e){for(var t=0;t<e;t++)this.applyResult(this.state.solver.execute());this.setState({currentTick:this.state.currentTick+e})}},{key:"render",value:function(){return Object(O.jsxs)("div",{children:[Object(O.jsx)("button",{onClick:this.onClick,children:"Test"}),Object(O.jsx)("h2",{children:k.title}),Object(O.jsx)(C,{setNewModel:this.setModel}),Object(O.jsx)(w,{onSimulate:this.onSimulate,changeStepSize:this.changeStepSize,stepSize:this.state.stepSize,selectedSolver:this.state.selectedSolver,changeSelectedSolver:this.changeSelectedSolver}),Object(O.jsx)(g,{model:this.state.model,timeSteps:this.state.timeSteps,currentTick:this.state.currentTick},this.state.currentTick+"chart"),Object(O.jsx)(M,{model:this.state.model},this.state.currentTick+"graph")]})}}]),a}(r.a.Component),T=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,86)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,s=t.getLCP,i=t.getTTFB;a(e),n(e),r(e),s(e),i(e)}))};i.a.render(Object(O.jsx)(r.a.StrictMode,{children:Object(O.jsx)(D,{})}),document.getElementById("root")),T()}},[[77,1,2]]]);
//# sourceMappingURL=main.11d2965b.chunk.js.map