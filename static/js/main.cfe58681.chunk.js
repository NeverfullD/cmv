(this.webpackJsonpcmv=this.webpackJsonpcmv||[]).push([[0],{45:function(e,t,n){},48:function(e,t,n){},61:function(e,t,n){},62:function(e,t,n){},75:function(e,t,n){},76:function(e,t,n){"use strict";n.r(t);var a=n(1),i=n.n(a),s=n(28),r=n.n(s),o=(n(45),n(3)),c=n(4),u=n(5),l=n(6),h=function(){function e(t,n,a){Object(o.a)(this,e),this.stepSize=void 0,this.timeStep=void 0,this.model=void 0,this.stepSize=t,this.timeStep=n,this.model=a}return Object(c.a)(e,[{key:"evaluateExpression",value:function(e,t){return e.evaluate(Object.fromEntries(t))}},{key:"generateVariables",value:function(){var e=new Map;return this.model.compartments.forEach((function(t){return e.set(t.name,t.value[t.value.length-1])})),e}}]),e}(),p=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"execute",value:function(){var e=this,t=this.generateVariables(),n=new Map;return this.model.compartments.forEach((function(a){var i=e.evaluateExpression(a.ODE,t)*e.stepSize;n.set(a.name,a.value[a.value.length-1]+i)})),this.timeStep=this.timeStep+this.stepSize,{result:n,timeStep:this.timeStep}}}]),n}(h),m=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"execute",value:function(){var e=this,t=this.generateVariables(),n=new Map,a=new Map(t);return this.model.compartments.forEach((function(n){var i=e.evaluateExpression(n.ODE,t)*(e.stepSize/2);a.set(n.name,n.value[n.value.length-1]+i)})),this.model.compartments.forEach((function(t){var i=e.evaluateExpression(t.ODE,a)*e.stepSize;n.set(t.name,t.value[t.value.length-1]+i)})),this.timeStep=this.timeStep+this.stepSize,{result:n,timeStep:this.timeStep}}}]),n}(h),v=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"calculateStep",value:function(e,t){var n=this,a=new Map,i=new Map(e),s=new Map;return this.model.compartments.forEach((function(a){var r=n.evaluateExpression(a.ODE,e)*t;i.set(a.name,e.get(a.name)+r/2),s.set(a.name,[r])})),this.model.compartments.forEach((function(a){var r=n.evaluateExpression(a.ODE,i)*t;i.set(a.name,e.get(a.name)+r/2),s.get(a.name).push(r)})),this.model.compartments.forEach((function(a){var r=n.evaluateExpression(a.ODE,i)*t;i.set(a.name,e.get(a.name)+r),s.get(a.name).push(r)})),this.model.compartments.forEach((function(e){var a=n.evaluateExpression(e.ODE,i)*t;s.get(e.name).push(a)})),this.model.compartments.forEach((function(t){a.set(t.name,e.get(t.name)+1/6*s.get(t.name)[0]+2/6*s.get(t.name)[1]+2/6*s.get(t.name)[2]+1/6*s.get(t.name)[3])})),a}}]),n}(h),S=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"execute",value:function(){var e=this.generateVariables();return this.timeStep=this.timeStep+this.stepSize,{result:this.calculateStep(e,this.stepSize),timeStep:this.timeStep}}}]),n}(v),d=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e,a,i){var s;return Object(o.a)(this,n),(s=t.call(this,e,a,i)).error=void 0,s.error=0,s}return Object(c.a)(n,[{key:"execute",value:function(){var e=[],t=.01,n=this.generateVariables();do{this.error<.0025?this.stepSize=2*this.stepSize:this.error>t&&(this.stepSize=this.stepSize/2);var a=this.calculateStep(n,this.stepSize),i=this.calculateStep(this.calculateStep(n,this.stepSize/2),this.stepSize/2);Array.from(a.values()).forEach((function(t,n){e.push(Math.abs(Array.from(i.values())[n]-t))})),this.error=e.reduce((function(e,t){return e+t}),0)/e.length}while(this.error>t);return this.timeStep=this.timeStep+this.stepSize,{result:i,timeStep:this.timeStep}}}]),n}(v),f=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e,a,i,s){var r;return Object(o.a)(this,n),(r=t.call(this,e,a,i)).error=void 0,r.depth=void 0,r.error=0,r.depth=s,r}return Object(c.a)(n,[{key:"execute",value:function(){var e=this,t=this.generateVariables(),n=.001,a=[];do{this.error<5e-4?this.depth>2?this.depth=this.depth-1:(this.stepSize=2*this.stepSize,this.depth=this.depth+1):this.error>n&&(this.depth<8?this.depth=this.depth+1:(this.stepSize=this.stepSize/2,this.depth=this.depth-1));for(var i=[],s=function(n){a[n]=[];for(var s=function(s){0===s?a[n][s]=e.modifiedMidpointMethod(t,2*(n+1)):(o=new Map,e.model.compartments.forEach((function(t){var r=a[n][s-1].get(t.name)+(a[n][s-1].get(t.name)-a[n-1][s-1].get(t.name))/(Math.pow(n/(n-1),2*s)-1);o.set(t.name,r),s===n&&n===e.depth-1&&i.push(Math.abs((a[n][s-1].get(t.name)-a[n-1][s-1].get(t.name))/(Math.pow(n/(n-1),2*s)-1)))})),a[n][s]=o)},r=0;r<=n;r++)s(r)},r=0;r<this.depth;r++){var o;s(r)}this.error=i.reduce((function(e,t){return e+t}),0)/i.length}while(this.error>n);return this.timeStep=this.timeStep+this.stepSize,{result:a[a.length-1][a[a.length-1].length-1],timeStep:this.timeStep}}},{key:"modifiedMidpointMethod",value:function(e,t){var n=this,a=this.stepSize/t,i=new Map(e),s=new Map,r=new Map;this.model.compartments.forEach((function(e){var t=n.evaluateExpression(e.ODE,i),r=e.value[e.value.length-1]+a*t;i.set(e.name,r),s.set(e.name,[e.value[e.value.length-1],r])}));for(var o=function(e){n.model.compartments.forEach((function(t){var r=n.evaluateExpression(t.ODE,i),o=s.get(t.name)[e-1]+2*a*r;i.set(t.name,o),s.get(t.name).push(o)}))},c=1;c<t;c++)o(c);return this.model.compartments.forEach((function(e){var o=n.evaluateExpression(e.ODE,i),c=.5*(s.get(e.name)[t]+s.get(e.name)[t-1]+a*o);r.set(e.name,c)})),r}}]),n}(h),j=n(31),b=(n(48),n(2)),O=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;Object(o.a)(this,n);var i=(a=t.call(this,e)).generateData();return a.state={data:i},a}return Object(c.a)(n,[{key:"generateData",value:function(){var e=this,t=[],n=["x"];this.props.model.compartments.forEach((function(e){return n.push(e.name)})),t.push(n);for(var a=function(n){s=[e.props.timeSteps[n]],e.props.model.compartments.forEach((function(e){return s.push(e.value[n])})),t.push(s)},i=0;i<=this.props.currentTick;i++){var s;a(i)}return t}},{key:"componentDidMount",value:function(){}},{key:"onClick",value:function(){}},{key:"render",value:function(){return Object(b.jsxs)("div",{className:"chart",children:["Chart",Object(b.jsx)(j.a,{width:"600px",height:"400px",chartType:"LineChart",loader:Object(b.jsx)("div",{children:"Loading Chart"}),data:this.state.data,options:{hAxis:{title:"Time"},vAxis:{title:"Value"}},rootProps:{"data-testid":"2"}})]})}}]),n}(i.a.Component),g=n(38),x=(n(61),function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;Object(o.a)(this,n);var i=(a=t.call(this,e)).generateInitialDataStructure();return a.state={data:i},a}return Object(c.a)(n,[{key:"generateInitialDataStructure",value:function(){var e=[];this.props.model.compartments.forEach((function(t){e.push({id:t.name,size:10})}));var t=[];return this.props.model.compartments.forEach((function(e){e.ODE.symbols().forEach((function(n){return t.push({source:e.name,target:n})}))})),{nodes:e,links:t}}},{key:"componentDidMount",value:function(){}},{key:"onClick",value:function(){}},{key:"render",value:function(){return Object(b.jsxs)("div",{className:"graph",children:["Graph",Object(b.jsx)(g.a,{graphData:this.state.data,nodeLabel:"id",nodeVal:function(e){return e.size},width:500,height:500})]})}}]),n}(i.a.Component)),k=(n(62),n(37)),E=n(74).Parser,z=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={value:"(param alpha 0.75)\n(param beta 0.1)\n(param N 10000)\n\n(comp S 9999 {-alpha*S*I/N})\n(comp I 1 {alpha*S*I/N - beta*I})\n(comp R 0 {beta*I})",parser:Object(k.generate)('{{\nfunction makeFloat(o) {\n    return parseFloat(o.join(""), 10);\n}\n}}\n\nmodel = parameters:parameter* _ compartments:compartment+ {return {parameters, compartments};}\ncompartment = "(" _ "comp" _ name:ident _ value:value _ ODE:calc _ ")" _ {return {name, value:[value], ODE};}\nparameter = "(" _ "param" _ name:ident _ value:value _ ")" _ {return {name, value};}\nident = ident:[A-Za-z]+ {return ident.join("")}\nvalue = digits:[0-9.]+ {return makeFloat(digits);}\n_ "whitespace" = [ \\t\\n\\r]*\ncalc = "{" calc:[^}]* "}" {return calc.join("")}')},a}return Object(c.a)(n,[{key:"onClick",value:function(e){var t=this.state.parser.parse(this.state.value),n=new Map;t.parameters.forEach((function(e){return n.set(e.name,e.value)})),t.compartments.forEach((function(e){return e.ODE=E.parse(e.ODE).simplify(Object.fromEntries(n))})),this.props.setNewModel(t),e.preventDefault()}},{key:"handleChange",value:function(e){this.setState({value:e.target.value})}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return Object(b.jsxs)("div",{className:"parser",children:["Parser",Object(b.jsxs)("form",{onSubmit:this.onClick.bind(this),children:[Object(b.jsxs)("label",{children:["Model:",Object(b.jsx)("br",{}),Object(b.jsx)("textarea",{className:"parserText",value:this.state.value,onChange:this.handleChange.bind(this)})]}),Object(b.jsx)("br",{}),Object(b.jsx)("input",{type:"submit",value:"Submit"})]})]})}}]),n}(i.a.Component),y=(n(75),function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).onSimulate1=function(){a.props.onSimulate(1)},a.onSimulate10=function(){a.props.onSimulate(10)},a.onSimulate100=function(){a.props.onSimulate(100)},a.onSimulate1000=function(){a.props.onSimulate(1e3)},a.onSimulate=function(){a.props.onSimulate(parseInt(a.state.steps))},a.onChangeStepSize=function(){a.props.changeStepSize(parseFloat(a.state.stepSize))},a.handleChangeSteps=function(e){a.setState({steps:e.target.value})},a.handleChangeStepSize=function(e){a.setState({stepSize:e.target.value})},a.handleSelectedSolver=function(e){a.props.changeSelectedSolver(e.target.value)},a.state={steps:"",stepSize:""},a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return Object(b.jsxs)("div",{className:"settings",children:["Settings",Object(b.jsx)("br",{}),Object(b.jsx)("button",{onClick:this.onSimulate1,children:"Simulate 1"}),Object(b.jsx)("button",{onClick:this.onSimulate10,children:"Simulate 10"}),Object(b.jsx)("button",{onClick:this.onSimulate100,children:"Simulate 100"}),Object(b.jsx)("button",{onClick:this.onSimulate1000,children:"Simulate 1000"}),Object(b.jsx)("button",{onClick:this.onSimulate,children:"Simulate: "}),Object(b.jsx)("input",{type:"text",value:this.state.steps,onChange:this.handleChangeSteps}),Object(b.jsx)("br",{}),Object(b.jsxs)("button",{onClick:this.onChangeStepSize,children:["Change Step Size (currently: ",this.props.stepSize,"): "]}),Object(b.jsx)("input",{type:"text",value:this.state.stepSize,onChange:this.handleChangeStepSize}),Object(b.jsx)("br",{}),Object(b.jsx)("label",{children:"Choose a Solver:"}),Object(b.jsxs)("select",{value:this.props.selectedSolver,onChange:this.handleSelectedSolver,children:[Object(b.jsx)("option",{value:"euler",children:"Euler"}),Object(b.jsx)("option",{value:"rungeKutta2",children:"Runge-Kutta 2.Order"}),Object(b.jsx)("option",{value:"rungeKutta4",children:"Runge-Kutta 4.Order"}),Object(b.jsx)("option",{value:"rungeKutta4Automatic",children:"Runge-Kutta 4.Order Automatic"}),Object(b.jsx)("option",{value:"bulirschStoer",children:"Bulirsch-Stoer"})]})]})}}]),n}(i.a.Component)),C=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).onClick=function(){console.log(a.state)},a.setModel=function(e){a.setState({model:e,currentTick:0,timeSteps:[0],solver:a.getSolver(a.state.selectedSolver,0,e)})},a.onSimulate=function(e){a.solveSteps(e)},a.changeStepSize=function(e){a.setState({stepSize:e})},a.changeSelectedSolver=function(e){a.setState({selectedSolver:e,solver:a.getSolver(e,a.state.timeSteps[a.state.timeSteps.length-1],a.state.model)})},a.state={model:{parameters:[],compartments:[]},currentTick:0,timeSteps:[],stepSize:.1,solver:new p(0,0,{parameters:[],compartments:[]}),selectedSolver:"euler"},a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){}},{key:"getSolver",value:function(e,t,n){switch(e){case"euler":return new p(this.state.stepSize,t,n);case"rungeKutta2":return new m(this.state.stepSize,t,n);case"rungeKutta4":return new S(this.state.stepSize,t,n);case"rungeKutta4Automatic":return new d(this.state.stepSize,t,n);case"bulirschStoer":return new f(this.state.stepSize,t,n,4);default:return new p(this.state.stepSize,t,n)}}},{key:"applyResult",value:function(e){this.state.model.compartments.forEach((function(t){t.value.push(e.result.get(t.name))})),this.state.timeSteps.push(e.timeStep)}},{key:"solveSteps",value:function(e){for(var t=0;t<e;t++)this.applyResult(this.state.solver.execute());this.setState({currentTick:this.state.currentTick+e})}},{key:"render",value:function(){return Object(b.jsxs)("div",{children:["Test",Object(b.jsx)("button",{onClick:this.onClick,children:"Test"}),Object(b.jsx)("a",{href:"https://github.com/NeverfullD/cmv",children:"to Github"}),Object(b.jsx)(z,{setNewModel:this.setModel}),Object(b.jsx)(y,{onSimulate:this.onSimulate,changeStepSize:this.changeStepSize,stepSize:this.state.stepSize,selectedSolver:this.state.selectedSolver,changeSelectedSolver:this.changeSelectedSolver}),Object(b.jsx)(O,{model:this.state.model,timeSteps:this.state.timeSteps,currentTick:this.state.currentTick},this.state.currentTick+"chart"),Object(b.jsx)(x,{model:this.state.model},this.state.currentTick+"graph")]})}}]),n}(i.a.Component),w=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,85)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,s=t.getLCP,r=t.getTTFB;n(e),a(e),i(e),s(e),r(e)}))};r.a.render(Object(b.jsx)(i.a.StrictMode,{children:Object(b.jsx)(C,{})}),document.getElementById("root")),w()}},[[76,1,2]]]);
//# sourceMappingURL=main.cfe58681.chunk.js.map